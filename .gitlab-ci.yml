image:
  name: docker/compose:1.22.0 # update tag to whatever version you want to use.
  entrypoint: [""]

variables:
  DOCKER_HOST: tcp://docker:2375/
  # use the overlayfs driver for improved performance.
  DOCKER_DRIVER: overlay2

services:
  - docker:dind

before_script:
  - docker info
  - docker-compose version
  - apk update
  - apk add git
  - chmod +x ./ci_scripts/if_readme_only.sh
  - sh ./ci_scripts/if_readme_only.sh 
  - echo $TEST_PASSWORD
  - echo "$DOCKER_PASSWORD" | docker login -u "$DOCKER_USERNAME" --password-stdin
  #- echo docker login -u "$DOCKER_USER" -p "$DOCKER_PASSWORD" docker.io

build:
  stage: build
  script:
    - docker info
    - docker image build -t samirgandhi/pingcommon ./pingcommon
    #- docker image build -t pingidentity/pingdatacommon ./pingdatacommon
    #- docker-compose -f ./pingdirectory/build.test.yml up
    #- docker image build -t samirgandhi/pingfederate ./pingfederate
    #- echo $DOCKER_PASSWORD | docker login --username $DOCKER_USERNAME --password-stdin
    - docker push samirgandhi/pingcommon
  tags:
    - devops_gte